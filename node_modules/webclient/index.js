'use strict';
var curl = require('./lib/curl');
var WebClientJar = require('./lib/cookie');

function WebClient(opts) {
    return curl(opts).then(function(result) {
        let response = result[0];

        if (opts.followRedirect && 'location' in response.caseless) {
            return redirect(opts, response);
        } else {
            return result;
        }
    });
}

WebClient.get = function (opts) {
    opts.method = 'GET';
    return WebClient(opts);
};

WebClient.post = function (opts) {
    opts.method = 'POST';
    return WebClient(opts);
};

WebClient.jar = function(jar) {
    return new WebClientJar(jar);
}

module.exports = WebClient;

// Cyclic requirements
var redirect = require('./lib/redirect');
